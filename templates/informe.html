{% extends 'base.html' %}
{% block title %} INFORMES {% endblock %}

{% block buttons %}
<a href="{{ url_for('home') }}" class="boton-ventana estiloBtn">INICIO</a>
<a href="{{ url_for('informe.informe_ventas') }}" class="boton-ventana estiloBtn">INFORME VENTA</a>
<a href="{{ url_for('informe.informe_usuario') }}" class="boton-ventana estiloBtn">INFORME USUARIO</a>
{% include 'botonInforme/informe-buscar.html' %}
{% endblock %}

{% block content %}
{% if tipo == 'ventas' %}
<h3 class="text-2xl font-semibold mb-4 text-gray-300">Tabla de Ventas</h3>

<div class="overflow-x-auto">
<div class="my-6">


  <table id="tablaVentas" class="dataTable min-w-full bg-gray-900 shadow-md rounded-lg overflow-hidden">
    <thead class="bg-gray-800">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Fecha</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Usuario</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Producto</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Cantidad</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Precio Unitario</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Subtotal</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-700">
      {% for v in ventas %}
      <tr>
        <td class="px-6 py-4 text-sm text-gray-200">{{ v[0] }}</td>
        <td class="px-6 py-4 text-sm text-gray-200">{{ v[1] }}</td>
        <td class="px-6 py-4 text-sm text-gray-200">{{ v[2] }}</td>
        <td class="px-6 py-4 text-sm text-gray-200 text-center">{{ v[3] }}</td>
        <td class="px-6 py-4 text-sm text-gray-200 text-right">${{ '%.2f'|format(v[4]) }}</td>
        <td class="px-6 py-4 text-sm text-gray-200 text-right font-semibold">${{ '%.2f'|format(v[5]) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% elif tipo == 'usuario' %}
  <h2 class="text-2xl text-gray-100">Gráfico de ventas por usuario</h2>
  <p class="text-gray-300">Aquí irá el gráfico de ventas de los vendedores.</p>




{% elif tipo == 'ventas_hoy' %}
<h3 class="text-2xl font-semibold mb-4 text-gray-300">Ventas del Día de hoy</h3>

<div class="my-6">
  <h4 class="text-xl font-semibold text-gray-200 mb-2">Gráfico de Ventas por Hora (Hoy)</h4>
  <canvas id="graficoVentasHora" class="bg-gray-800 rounded-lg p-4 shadow-md" width="700" height="300"></canvas>
<!--Aca va el grafico de ventas del dia de hoy aca y solo aca necesito que se visualize el grafico quiero que sea simple por dios-->
</div>

{% else %}
  <p class="text-gray-300 mt-4">Seleccioná una opción de informe arriba.</p>
{% endif %}

{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Solo inicializar si no está ya inicializado
    if (!$.fn.DataTable.isDataTable('#tablaVentas')) {
      $('#tablaVentas').DataTable({
        language: {
          lengthMenu: "Mostrar _MENU_ registros por página",
          zeroRecords: "No se encontraron resultados",
          info: "Mostrando página _PAGE_ de _PAGES_",
          infoEmpty: "Sin registros disponibles",
          infoFiltered: "(filtrado de _MAX_ registros totales)",
          search: "Buscar:",
          paginate: {
            previous: "Anterior",
            next: "Siguiente"
          }
        },
        pageLength: 10
      });
    }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const canvas = document.getElementById("graficoVentasHora");
  if (!canvas) return;  // Solo si estamos en el modo 'ventas_hoy'

  fetch("/api/ventas/hoy")
    .then(res => res.json())
    .then(datos => {
      if (!datos.length) return;

      const horas = datos.map(d => d.hora);
      const totales = datos.map(d => d.total);

      new Chart(canvas, {
        type: 'line',
        data: {
          labels: horas,
          datasets: [{
            label: 'Ventas por hora ($)',
            data: totales,
            borderColor: 'rgba(59, 130, 246, 1)',
            backgroundColor: 'rgba(59, 130, 246, 0.2)',
            tension: 0.4,
            fill: true,
            pointBackgroundColor: 'rgba(59, 130, 246, 1)',
            pointRadius: 5
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: { color: '#ffffff' }
            },
            tooltip: {
              callbacks: {
                label: ctx => `$${ctx.parsed.y.toFixed(2)}`
              }
            }
          },
          scales: {
            x: {
              ticks: { color: '#ffffff' }
            },
            y: {
              beginAtZero: true,
              ticks: {
                color: '#ffffff',
                callback: value => `$${value}`
              }
            }
          }
        }
      });
    });
});
</script>


{% endblock %}
